<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>论文提示词自动完善工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36CFC9',
                        neutral: '#F5F7FA',
                        dark: '#1D2129',
                        light: '#F2F3F5'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .nav-active {
                @apply bg-primary text-white border-l-4 border-primary;
            }
            .card-shadow {
                @apply shadow-lg hover:shadow-xl transition-shadow duration-300;
            }
            .btn-effect {
                @apply transform hover:scale-105 active:scale-95 transition-transform duration-200;
            }
            .prompt-btn.active {
                @apply bg-primary/10 text-primary border-primary;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-dark">
    <div class="flex h-screen overflow-hidden">
        <!-- 左侧导航 -->
        <aside class="w-64 bg-white border-r border-gray-200 flex-shrink-0 hidden md:block">
            <nav class="h-full flex flex-col py-6">
                <div class="px-6 mb-8">
                    <h1 class="text-xl font-bold text-primary flex items-center">
                        <i class="fa fa-file-text-o mr-2"></i>论文助手
                    </h1>
                </div>
                
                <ul class="space-y-1 px-3 flex-grow">
                    <li>
                        <a href="#开题报告" class="nav-item nav-active flex items-center px-4 py-3 text-sm rounded-lg transition-all duration-200">
                            <i class="fa fa-bookmark-o w-5 text-center mr-3"></i>
                            <span>开题报告</span>
                        </a>
                        <!-- 子导航容器（每个主导航项都有自己的容器） -->
                        <ul class="sub-nav-container space-y-1 px-3 mt-2"></ul>
                    </li>
                    <li>
                        <a href="#文献综述" class="nav-item flex items-center px-4 py-3 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition-all duration-200">
                            <i class="fa fa-list-alt w-5 text-center mr-3"></i>
                            <span>文献综述</span>
                        </a>
                        <ul class="sub-nav-container space-y-1 px-3 mt-2 hidden"></ul>
                    </li>
                    <li>
                        <a href="#正文" class="nav-item flex items-center px-4 py-3 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition-all duration-200">
                            <i class="fa fa-file-text w-5 text-center mr-3"></i>
                            <span>正文</span>
                        </a>
                        <ul class="sub-nav-container space-y-1 px-3 mt-2 hidden"></ul>
                    </li>
                    <li>
                        <a href="#论文修改" class="nav-item flex items-center px-4 py-3 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition-all duration-200">
                            <i class="fa fa-pencil w-5 text-center mr-3"></i>
                            <span>论文修改</span>
                        </a>
                        <ul class="sub-nav-container space-y-1 px-3 mt-2 hidden"></ul>
                    </li>
                    <li>
                        <a href="#问卷实证" class="nav-item flex items-center px-4 py-3 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition-all duration-200">
                            <i class="fa fa-bar-chart w-5 text-center mr-3"></i>
                            <span>问卷实证</span>
                        </a>
                        <ul class="sub-nav-container space-y-1 px-3 mt-2 hidden"></ul>
                    </li>
                </ul>
                
                
                
                <div class="px-6 pt-6 border-t border-gray-200">
                    <div class="flex items-center text-sm text-gray-500">
                        <i class="fa fa-info-circle mr-2"></i>
                        <span>提示词将自动完善</span>
                    </div>
                </div>
            </nav>
        </aside>
        
        <!-- 右侧内容区 -->
        <main class="flex-1 overflow-y-auto bg-gray-50 p-6 md:p-8">
            <!-- 移动端菜单按钮 -->
            <div class="md:hidden mb-6">
                <button id="menuToggle" class="bg-white p-2 rounded-md shadow-sm">
                    <i class="fa fa-bars text-gray-600"></i>
                </button>
            </div>
            
            <!-- 全局专业、学历和研究主题输入 -->
            <div class="mb-8 bg-white rounded-xl p-6 card-shadow">
                <h2 class="text-xl font-bold mb-4 pb-2 border-b border-gray-100">基本信息</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="major" class="block text-sm font-medium text-gray-700 mb-1">请输入专业</label>
                        <input type="text" id="major" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all" placeholder="例如：计算机科学与技术">
                    </div>
                    <div>
                        <label for="education" class="block text-sm font-medium text-gray-700 mb-1">请输入学历</label>
                        <input type="text" id="education" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all" placeholder="例如：本科 / 硕士 / 博士">
                    </div>
                    <div>
                        <label for="researchTopic" class="block text-sm font-medium text-gray-700 mb-1">请输入研究主题</label>
                        <input type="text" id="researchTopic" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all" placeholder="例如：人工智能在教育中的应用研究">
                    </div>

                    <!-- 新增：一次性解析输入 -->
                    <div class="md:col-span-2">
                        <label for="bulkInput" class="block text-sm font-medium text-gray-700 mb-1">一次性输入（专业 学历 研究主题）</label>
                        <textarea id="bulkInput" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all" placeholder="支持用换行、逗号、斜线或空格分隔，例如：计算机科学与技术 本科 人工智能在教育中的应用研究"></textarea>
                        <div class="mt-2 flex gap-2">
                            <button id="parseBulkBtn" class="bg-primary text-white px-3 py-1 rounded-lg btn-effect">解析并填充</button>
                            <button id="clearBulkBtn" class="bg-white border px-3 py-1 rounded-lg">清空</button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">支持换行 / 逗号 / 分号 / 斜线 / 空格分隔；若包含学历关键词（本科/硕士/博士）会自动识别。</p>
                    </div>
                </div>
            </div>
            
            <!-- 开题报告部分 -->
                <!-- 提示词完善：
                    1,复制框架后 修改id和data-group  （data-group = id去掉Prompt） 
                    2,增加activePrompts和basePrompts的内容
                    【实际操作：修改注释之后回车AI会自动完成剩余内容】
                -->
                <!-- 文本复制完善：
                    1,复制框架后 修改id和title 
                    2,搜索id：copySectionTitleBtn 查看另一处要改的内容
                    【实际操作：另一处复制框架后 修改第一个id之后AI会自动完成剩余内容】
                -->
            <section id="开题报告" class="mb-12 bg-white rounded-xl p-6 card-shadow">
                <h2 class="text-2xl font-bold mb-6 pb-3 border-b border-gray-100">开题报告
                    <button id="copySectionTitleBtn" class="ml-3 text-primary hover:text-blue-700 text-base" title="复制标题">
                        <i class="fa fa-copy"></i>
                    </button>
                </h2>

                <!-- 大模型分析框架部分 -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <span class="inline-block w-6 h-6 rounded-full bg-primary text-white text-sm flex items-center justify-center mr-2"></span>
                        大模型分析框架
                    </h3>
                    
                    <div class="bg-neutral p-4 rounded-lg mb-4 relative">
                        <div class="flex flex-wrap gap-2 mt-2">
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="请使用学术化语言，避免口语表达" data-group="framework">
                                <i class="fa fa-check-circle text-primary mr-1"></i>学术化
                            </button>
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="请确保内容具有时效性，引用近3年的研究成果" data-group="framework">
                                <i class="fa fa-clock-o text-primary mr-1"></i>时效性
                            </button>
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="记住，不要有AI味" data-group="framework">
                                <i class="fa fa-ban text-primary mr-1"></i>去AI味
                            </button>
                        </div>
                        <pre id="frameworkPrompt" class="text-sm whitespace-pre-line">大模型分析框架提示词</pre>
                    </div>

                    <div class="flex justify-end">
                        <button class="copy-btn bg-primary text-white px-4 py-2 rounded-lg flex items-center btn-effect" data-target="frameworkPrompt">
                            <i class="fa fa-copy mr-2"></i>复制
                        </button>
                    </div>
                </div>
                
                <!-- 研究背景部分 -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <span class="inline-block w-6 h-6 rounded-full bg-primary text-white text-sm flex items-center justify-center mr-2"></span>
                        研究背景
                    </h3>
                    
                    <div class="bg-neutral p-4 rounded-lg mb-4 relative">
                        <div class="flex flex-wrap gap-2 mt-2">
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="请使用学术化语言，避免口语表达" data-group="background">
                                <i class="fa fa-check-circle text-primary mr-1"></i>学术化
                            </button>
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="请确保内容具有时效性，引用近3年的研究成果" data-group="background">
                                <i class="fa fa-clock-o text-primary mr-1"></i>时效性
                            </button>
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="记住，不要有AI味" data-group="background">
                                <i class="fa fa-ban text-primary mr-1"></i>去AI味
                            </button>
                        </div>
                        <pre id="backgroundPrompt" class="text-sm whitespace-pre-line">研究背景提示词</pre>
                    </div>

                    <div class="flex justify-end">
                        <button class="copy-btn bg-primary text-white px-4 py-2 rounded-lg flex items-center btn-effect" data-target="backgroundPrompt">
                            <i class="fa fa-copy mr-2"></i>复制
                        </button>
                    </div>
                    
                    <div class="bg-neutral p-4 rounded-lg mb-4 relative">
                        <div class="flex flex-wrap gap-2 mt-2">
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="请使用学术化语言，避免口语表达" data-group="background1">
                                <i class="fa fa-check-circle text-primary mr-1"></i>学术化
                            </button>
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="请确保内容具有时效性，引用近3年的研究成果" data-group="background1">
                                <i class="fa fa-clock-o text-primary mr-1"></i>时效性
                            </button>
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="记住，不要有AI味" data-group="background1">
                                <i class="fa fa-ban text-primary mr-1"></i>去AI味
                            </button>
                        </div>
                        <pre id="background1Prompt" class="text-sm whitespace-pre-line">研究背景提示词1</pre>
                    </div>

                    <div class="flex justify-end">
                        <button class="copy-btn bg-primary text-white px-4 py-2 rounded-lg flex items-center btn-effect" data-target="background1Prompt">
                            <i class="fa fa-copy mr-2"></i>复制
                        </button>
                    </div>
                </div>

                <!-- 研究意义部分 -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <span class="inline-block w-6 h-6 rounded-full bg-primary text-white text-sm flex items-center justify-center mr-2"></span>
                        研究意义
                    </h3>

                    <div class="mb-4">
                        <label for="chapterTitle" class="block text-sm font-medium text-gray-700 mb-1">请输入章节题目</label>
                        <input type="text" id="chapterTitle" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all" placeholder="例如：绪论">
                    </div>

                    <div class="bg-neutral p-4 rounded-lg mb-4 relative">
                        <div class="flex flex-wrap gap-2 mt-2">
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="请分点阐述，但不要使用数字序号" data-group="significance">
                                <i class="fa fa-list text-primary mr-1"></i>分点阐述
                            </button>
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="请使用3级标题组织内容" data-group="significance">
                                <i class="fa fa-header text-primary mr-1"></i>3级标题
                            </button>
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="请增加案例支持论点" data-group="significance">
                                <i class="fa fa-file-text-o text-primary mr-1"></i>加案例
                            </button>
                        </div>
                        <pre id="significancePrompt" class="text-sm whitespace-pre-line">研究意义提示词</pre>
                    </div>
                    
                    <div class="flex justify-end">
                        <button class="copy-btn bg-primary text-white px-4 py-2 rounded-lg flex items-center btn-effect" data-target="significancePrompt">
                            <i class="fa fa-copy mr-2"></i>复制
                        </button>
                    </div>
                </div>
                
                <!-- 研究目标部分 -->
                <div>
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <span class="inline-block w-6 h-6 rounded-full bg-primary text-white text-sm flex items-center justify-center mr-2"></span>
                        研究目标
                    </h3>

                    <div class="bg-neutral p-4 rounded-lg mb-4 relative">
                        <div class="flex flex-wrap gap-2 mt-2">
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="请分点阐述，但不要使用数字序号" data-group="objectives">
                                <i class="fa fa-list text-primary mr-1"></i>分点阐述
                            </button>
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="请使用3级标题组织内容" data-group="objectives">
                                <i class="fa fa-header text-primary mr-1"></i>3级标题
                            </button>
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="请确保目标可衡量、可实现" data-group="objectives">
                                <i class="fa fa-check-square-o text-primary mr-1"></i>可衡量
                            </button>
                        </div>
                        <pre id="objectivesPrompt" class="text-sm whitespace-pre-line">研究目标提示词</pre>
                    </div>
                    
                    <div class="flex justify-end">
                        <button class="copy-btn bg-primary text-white px-4 py-2 rounded-lg flex items-center btn-effect" data-target="objectivesPrompt">
                            <i class="fa fa-copy mr-2"></i>复制
                        </button>
                    </div>
                </div>

                <!-- 研究内容部分 -->
                <div>
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <span class="inline-block w-6 h-6 rounded-full bg-primary text-white text-sm flex items-center justify-center mr-2"></span>
                        研究内容
                    </h3>

                    <div class="bg-neutral p-4 rounded-lg mb-4 relative">
                        <div class="flex flex-wrap gap-2 mt-2">
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="请分点阐述，但不要使用数字序号" data-group="ResearchContent">
                                <i class="fa fa-list text-primary mr-1"></i>分点阐述
                            </button>
                        </div>
                        <pre id="ResearchContentPrompt" class="text-sm whitespace-pre-line">研究内容提示词</pre>
                    </div>
                    
                    <div class="flex justify-end">
                        <button class="copy-btn bg-primary text-white px-4 py-2 rounded-lg flex items-center btn-effect" data-target="ResearchContentPrompt">
                            <i class="fa fa-copy mr-2"></i>复制
                        </button>
                    </div>
                </div>

                <!-- 研究方法部分 -->
                <div>
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <span class="inline-block w-6 h-6 rounded-full bg-primary text-white text-sm flex items-center justify-center mr-2"></span>
                        研究方法
                    </h3>

                    <div class="bg-neutral p-4 rounded-lg mb-4 relative">
                        <div class="flex flex-wrap gap-2 mt-2">
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="请分点阐述，但不要使用数字序号" data-group="ResearchMethods">
                                <i class="fa fa-list text-primary mr-1"></i>分点阐述
                            </button>
                        </div>
                        <pre id="ResearchMethodsPrompt" class="text-sm whitespace-pre-line">研究方法提示词</pre>
                    </div>

                    <div class="flex justify-end">
                        <button class="copy-btn bg-primary text-white px-4 py-2 rounded-lg flex items-center btn-effect" data-target="ResearchMethodsPrompt">
                            <i class="fa fa-copy mr-2"></i>复制
                        </button>
                    </div>
                </div>

                <!-- 论文提纲部分 -->
                <div class="mt-8">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <span class="inline-block w-6 h-6 rounded-full bg-primary text-white text-sm flex items-center justify-center mr-2"></span>
                        论文提纲
                    </h3>

                    <div class="bg-neutral p-4 rounded-lg mb-4 relative">
                        <div class="flex flex-wrap gap-2 mt-2">
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="请分点阐述，但不要使用数字序号" data-group="PaperOutline">
                                <i class="fa fa-list text-primary mr-1"></i>分点阐述
                            </button>
                        </div>
                        <pre id="PaperOutlinePrompt" class="text-sm whitespace-pre-line">论文提纲提示词</pre>
                    </div>

                    <div class="flex justify-end">
                        <button class="copy-btn bg-primary text-white px-4 py-2 rounded-lg flex items-center btn-effect" data-target="PaperOutlinePrompt">
                            <i class="fa fa-copy mr-2"></i>复制
                        </button>
                    </div>
                </div>

                <!-- 研究基础部分 -->
                <div class="mt-8">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <span class="inline-block w-6 h-6 rounded-full bg-primary text-white text-sm flex items-center justify-center mr-2"></span>
                        研究基础
                    </h3>

                    <div class="bg-neutral p-4 rounded-lg mb-4 relative">
                        <div class="flex flex-wrap gap-2 mt-2">
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="请分点阐述，但不要使用数字序号" data-group="ResearchFoundation">
                                <i class="fa fa-list text-primary mr-1"></i>分点阐述
                            </button>
                        </div>
                        <pre id="ResearchFoundationPrompt" class="text-sm whitespace-pre-line">研究基础提示词</pre>
                    </div>

                    <div class="flex justify-end">
                        <button class="copy-btn bg-primary text-white px-4 py-2 rounded-lg flex items-center btn-effect" data-target="ResearchFoundationPrompt">
                            <i class="fa fa-copy mr-2"></i>复制
                        </button>
                    </div>
                </div>
                

                <!-- 研究过程中可能遇到的困难和问题部分 -->
                <div class="mt-8">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <span class="inline-block w-6 h-6 rounded-full bg-primary text-white text-sm flex items-center justify-center mr-2"></span>
                        研究过程中可能遇到的困难和问题
                    </h3>

                    <div class="bg-neutral p-4 rounded-lg mb-4 relative">
                        <div class="flex flex-wrap gap-2 mt-2">
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="请分点阐述，但不要使用数字序号" data-group="ResearchChallenges">
                                <i class="fa fa-list text-primary mr-1"></i>分点阐述
                            </button>
                        </div>
                        <pre id="ResearchChallengesPrompt" class="text-sm whitespace-pre-line">研究过程中可能遇到的困难和问题提示词</pre>
                    </div>

                    <div class="flex justify-end">
                        <button class="copy-btn bg-primary text-white px-4 py-2 rounded-lg flex items-center btn-effect" data-target="ResearchChallengesPrompt">
                            <i class="fa fa-copy mr-2"></i>复制
                        </button>
                    </div>
                </div>

                <!-- 预期结果部分 -->
                <div class="mt-8">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <span class="inline-block w-6 h-6 rounded-full bg-primary text-white text-sm flex items-center justify-center mr-2"></span>
                        预期结果
                    </h3>

                    <div class="bg-neutral p-4 rounded-lg mb-4 relative">
                        <div class="flex flex-wrap gap-2 mt-2">
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="请分点阐述，但不要使用数字序号" data-group="ResearchExpectations">
                                <i class="fa fa-list text-primary mr-1"></i>分点阐述
                            </button>
                        </div>
                        <pre id="ResearchExpectationsPrompt" class="text-sm whitespace-pre-line">预期结果提示词</pre>
                    </div>

                    <div class="flex justify-end">
                        <button class="copy-btn bg-primary text-white px-4 py-2 rounded-lg flex items-center btn-effect" data-target="ResearchExpectationsPrompt">
                            <i class="fa fa-copy mr-2"></i>复制
                        </button>
                    </div>
                </div>

                <!-- 进度计划安排部分 -->
                <div class="mt-8">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <span class="inline-block w-6 h-6 rounded-full bg-primary text-white text-sm flex items-center justify-center mr-2"></span>
                        进度计划安排
                    </h3>

                    <div class="bg-neutral p-4 rounded-lg mb-4 relative">
                        <div class="flex flex-wrap gap-2 mt-2">
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="请分点阐述，但不要使用数字序号" data-group="ResearchTimeline">
                                <i class="fa fa-list text-primary mr-1"></i>分点阐述
                            </button>
                        </div>
                        <pre id="ResearchTimelinePrompt" class="text-sm whitespace-pre-line">进度计划安排提示词</pre>
                    </div>

                    <div class="flex justify-end">
                        <button class="copy-btn bg-primary text-white px-4 py-2 rounded-lg flex items-center btn-effect" data-target="ResearchTimelinePrompt">
                            <i class="fa fa-copy mr-2"></i>复制
                        </button>
                    </div>
                </div>

                <!-- 技术路线图部分 -->
                <div class="mt-8">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <span class="inline-block w-6 h-6 rounded-full bg-primary text-white text-sm flex items-center justify-center mr-2"></span>
                        技术路线图
                    </h3>

                    <div class="bg-neutral p-4 rounded-lg mb-4 relative">
                        <div class="flex flex-wrap gap-2 mt-2">
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="请分点阐述，但不要使用数字序号" data-group="ResearchRoadmap">
                                <i class="fa fa-list text-primary mr-1"></i>分点阐述
                            </button>
                        </div>
                        <pre id="ResearchRoadmapPrompt" class="text-sm whitespace-pre-line">技术路线图提示词</pre>
                    </div>

                    <div class="flex justify-end">
                        <button class="copy-btn bg-primary text-white px-4 py-2 rounded-lg flex items-center btn-effect" data-target="ResearchRoadmapPrompt">
                            <i class="fa fa-copy mr-2"></i>复制
                        </button>
                    </div>
                    <br/>

                    <div class="bg-neutral p-4 rounded-lg mb-4 relative">
                        <div class="flex flex-wrap gap-2 mt-2">
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="请分点阐述，但不要使用数字序号" data-group="ResearchRoadmap1">
                                <i class="fa fa-list text-primary mr-1"></i>分点阐述
                            </button>
                        </div>
                        <pre id="ResearchRoadmap1Prompt" class="text-sm whitespace-pre-line">技术路线图1提示词</pre>
                    </div>

                    <div class="flex justify-end">
                        <button class="copy-btn bg-primary text-white px-4 py-2 rounded-lg flex items-center btn-effect" data-target="ResearchRoadmap1Prompt">
                            <i class="fa fa-copy mr-2"></i>复制
                        </button>
                    </div>

                    <br/>
                    <div class="bg-neutral p-4 rounded-lg mb-4 relative">
                        <p>复制Mermaid 代码到以下网站编辑:
                            <button id="copyMermaidBtn" class="ml-3 text-primary hover:text-blue-700 text-base" title="Mermaid网站">
                                    <i class="fa fa-copy">https://app.diagrams.net/?src=about</i>
                            </button>
                            <br/>
                            <a href="https://app.diagrams.net/?src=about" target="_blank">https://app.diagrams.net/?src=about</a>
                        </p>
                    </div>
                
                    <br/>
                    <div class="bg-neutral p-4 rounded-lg mb-4 relative">
                        <p>添加「题注」：
                            <button id="addCaptionBtn" class="ml-3 text-primary hover:text-blue-700 text-base" title="题注">
                                    <i class="fa fa-copy">题注</i>
                            </button>
                        </p>
                    </div>
                
                    <br/>
                    <div class="bg-neutral p-4 rounded-lg mb-4 relative">
                        <p>新建标签_图1. ：
                            <button id="createLabelBtn" class="ml-3 text-primary hover:text-blue-700 text-base" title="图1.">
                                    <i class="fa fa-copy">图1.</i>
                            </button>
                        </p>
                    </div>
                
                    <br/>
                    <div class="bg-neutral p-4 rounded-lg mb-4 relative">
                        <p>交叉引用</p>
                    </div>


                </div>


            
            </section>

                <!-- 部分 -->


            <!-- 文献综述部分 (占位符) -->
            <section id="文献综述" class="mb-12 bg-white rounded-xl p-6 card-shadow">
                <h2 class="text-2xl font-bold mb-6 pb-3 border-b border-gray-100">文献综述</h2>
                <button id="copyReferenceBtn" class="ml-3 text-primary hover:text-blue-700 text-base" title="参考文献">
                        <i class="fa fa-copy">参考文献</i>
                </button>

                <!-- 确定关键词部分 -->
                <div class="mt-8">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <span class="inline-block w-6 h-6 rounded-full bg-primary text-white text-sm flex items-center justify-center mr-2"></span>
                        确定关键词
                    </h3>

                    <div class="bg-neutral p-4 rounded-lg mb-4 relative">
                        <div class="flex flex-wrap gap-2 mt-2">
                            <button class="prompt-btn bg-white text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50 btn-effect" data-prompt="请分点阐述，但不要使用数字序号" data-group="ResearchKeywords">
                                <i class="fa fa-list text-primary mr-1"></i>分点阐述
                            </button>
                        </div>
                        <pre id="ResearchKeywordsPrompt" class="text-sm whitespace-pre-line">确定关键词提示词</pre>
                    </div>

                    <div class="flex justify-end">
                        <button class="copy-btn bg-primary text-white px-4 py-2 rounded-lg flex items-center btn-effect" data-target="ResearchKeywordsPrompt">
                            <i class="fa fa-copy mr-2"></i>复制
                        </button>
                    </div>
                </div>

                <p class="text-gray-500">请在左侧导航选择此项以编辑内容</p>
                <!-- 这里将由用户后续补充完整 -->
            </section>
            
            <!-- 正文部分 (占位符) -->
            <section id="正文" class="mb-12 bg-white rounded-xl p-6 card-shadow">
                <h2 class="text-2xl font-bold mb-6 pb-3 border-b border-gray-100">正文</h2>

                <!-- 正文部分 -->
                <div class="mt-8">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <span class="inline-block w-6 h-6 rounded-full bg-primary text-white text-sm flex items-center justify-center mr-2"></span>
                        正文
                    </h3>
                </div>
                <p class="text-gray-500">请在左侧导航选择此项以编辑内容</p>
                <!-- 这里将由用户后续补充完整 -->
            </section>
            
            <!-- 论文修改部分 (占位符) -->
            <section id="论文修改" class="mb-12 bg-white rounded-xl p-6 card-shadow">
                <h2 class="text-2xl font-bold mb-6 pb-3 border-b border-gray-100">论文修改</h2>

                <!-- 论文修改部分 -->
                <div class="mt-8">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <span class="inline-block w-6 h-6 rounded-full bg-primary text-white text-sm flex items-center justify-center mr-2"></span>
                        论文修改
                    </h3>
                </div>
                <p class="text-gray-500">请在左侧导航选择此项以编辑内容</p>
                <!-- 这里将由用户后续补充完整 -->
            </section>
            
            <!-- 问卷实证部分 (占位符) -->
            <section id="问卷实证" class="mb-12 bg-white rounded-xl p-6 card-shadow">
                <h2 class="text-2xl font-bold mb-6 pb-3 border-b border-gray-100">问卷实证</h2>

                <!-- 问卷实证部分 -->
                <div class="mt-8">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <span class="inline-block w-6 h-6 rounded-full bg-primary text-white text-sm flex items-center justify-center mr-2"></span>
                        问卷实证
                    </h3>
                </div>
                <p class="text-gray-500">请在左侧导航选择此项以编辑内容</p>
                <!-- 这里将由用户后续补充完整 -->
            </section>
        </main>
    </div>
    
    <!-- 移动端侧边菜单 -->
    <div id="mobileMenu" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden md:hidden">
        <div class="w-64 h-full bg-white transform transition-transform duration-300 -translate-x-full" id="mobileMenuContent">
            <!-- 移动端菜单内容，与左侧导航相同 -->
            <nav class="h-full flex flex-col py-6">
                <div class="px-6 mb-8 flex justify-between items-center">
                    <h1 class="text-xl font-bold text-primary flex items-center">
                        <i class="fa fa-file-text-o mr-2"></i>论文助手
                    </h1>
                    <button id="closeMenu" class="text-gray-500">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                
                <ul class="space-y-1 px-3 flex-grow">
                    <li>
                        <a href="#开题报告" class="mobile-nav-item nav-active flex items-center px-4 py-3 text-sm rounded-lg transition-all duration-200">
                            <i class="fa fa-bookmark-o w-5 text-center mr-3"></i>
                            <span>开题报告</span>
                        </a>
                    </li>
                    <li>
                        <a href="#文献综述" class="mobile-nav-item flex items-center px-4 py-3 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition-all duration-200">
                            <i class="fa fa-list-alt w-5 text-center mr-3"></i>
                            <span>文献综述</span>
                        </a>
                    </li>
                    <li>
                        <a href="#正文" class="mobile-nav-item flex items-center px-4 py-3 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition-all duration-200">
                            <i class="fa fa-file-text w-5 text-center mr-3"></i>
                            <span>正文</span>
                        </a>
                    </li>
                    <li>
                        <a href="#论文修改" class="mobile-nav-item flex items-center px-4 py-3 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition-all duration-200">
                            <i class="fa fa-pencil w-5 text-center mr-3"></i>
                            <span>论文修改</span>
                        </a>
                    </li>
                    <li>
                        <a href="#问卷实证" class="mobile-nav-item flex items-center px-4 py-3 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition-all duration-200">
                            <i class="fa fa-bar-chart w-5 text-center mr-3"></i>
                            <span>问卷实证</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    
    <!-- 复制成功提示 -->
    <div id="copyToast" class="fixed bottom-6 right-6 bg-dark text-white px-4 py-2 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center">
        <i class="fa fa-check-circle mr-2"></i>
        <span>复制成功！</span>
    </div>

    <!-- 回到顶部按钮（初始隐藏） -->
    <button id="backToTop" aria-label="回到顶部" title="回到顶部"
        class="hidden fixed bottom-20 right-6 bg-primary text-white p-3 rounded-full shadow-lg hover:bg-primary/90 transition-all duration-200 z-50">
        <i class="fa fa-arrow-up"></i>
    </button>

    <script>
        // 等待DOM加载完成
        document.addEventListener('DOMContentLoaded', function() {
            // 获取DOM元素
            const majorInput = document.getElementById('major');
            const educationInput = document.getElementById('education');
            const researchTopicInput = document.getElementById('researchTopic');
            const chapterTitleInput = document.getElementById('chapterTitle');
            const promptButtons = document.querySelectorAll('.prompt-btn');
            const copyButtons = document.querySelectorAll('.copy-btn');
            const copyToast = document.getElementById('copyToast');
            const backToTop = document.getElementById('backToTop'); // 新增回到顶部按钮引用
            const navItems = document.querySelectorAll('.nav-item');
            const mobileNavItems = document.querySelectorAll('.mobile-nav-item');
            const menuToggle = document.getElementById('menuToggle');
            const mobileMenu = document.getElementById('mobileMenu');
            const mobileMenuContent = document.getElementById('mobileMenuContent');
            const closeMenu = document.getElementById('closeMenu');

            // 新增：批量输入解析相关元素
            const bulkInput = document.getElementById('bulkInput');
            const parseBulkBtn = document.getElementById('parseBulkBtn');
            const clearBulkBtn = document.getElementById('clearBulkBtn');

            // 解析函数：返回 {major, education, topic}
            function parseBulkText(text) {
                if (!text) return { major: '', education: '', topic: '' };
                text = text.trim();

                // 统一分隔符为单空格，去除多余空格
                let normalized = text.replace(/[\r\n,，;；\/\|]+/g, ' ').replace(/\s+/g, ' ').trim();
                if (!normalized) return { major: '', education: '', topic: '' };

                // 切分为 tokens（按空格）
                const tokens = normalized.split(' ').filter(Boolean);

                // 学历关键词（优先按 token 精确匹配）
                const degreeTokenRegex = /^(专科|函授|本科生?|本科|硕士(生?)?|博士(生?)?|博士后|学士|研究生)$/i;

                // 尝试在 tokens 中找到学历（精确 token）
                let degreeIndex = -1;
                for (let i = 0; i < tokens.length; i++) {
                    if (degreeTokenRegex.test(tokens[i])) {
                        degreeIndex = i;
                        break;
                    }
                }

                if (degreeIndex !== -1) {
                    const education = tokens[degreeIndex];
                    const rem = tokens.slice(0, degreeIndex).concat(tokens.slice(degreeIndex + 1));
                    if (rem.length >= 2) {
                        return { major: rem[0], education: education, topic: rem.slice(1).join(' ') };
                    } else if (rem.length === 1) {
                        return { major: rem[0], education: education, topic: '' };
                    } else {
                        return { major: '', education: education, topic: '' };
                    }
                }

                // 如果没有 token 精确匹配，再做子串匹配（处理“计算机硕士”之类情况）
                const degreeSubMatch = normalized.match(/(本科生?|本科|硕士(生?)?|博士(生?)?|博士后|学士|研究生)/i);
                if (degreeSubMatch) {
                    const education = degreeSubMatch[0];
                    const remaining = normalized.replace(degreeSubMatch[0], ' ').replace(/\s+/g, ' ').trim();
                    const remTokens = remaining.split(' ').filter(Boolean);
                    if (remTokens.length >= 2) {
                        return { major: remTokens[0], education: education, topic: remTokens.slice(1).join(' ') };
                    } else if (remTokens.length === 1) {
                        return { major: remTokens[0], education: education, topic: '' };
                    } else {
                        return { major: '', education: education, topic: '' };
                    }
                }

                // 回退策略：token 数量 >=3 -> major, education, topic；2 个 token -> major + topic
                if (tokens.length >= 3) {
                    return { major: tokens[0], education: tokens[1], topic: tokens.slice(2).join(' ') };
                } else if (tokens.length === 2) {
                    return { major: tokens[0], education: '', topic: tokens[1] };
                }

                // 兜底：全部视为研究主题
                return { major: '', education: '', topic: normalized };
            }

            // 点击解析并填充
            if (parseBulkBtn) {
                parseBulkBtn.addEventListener('click', function() {
                    const text = bulkInput.value || '';
                    const parsed = parseBulkText(text);

                    if (parsed.major) majorInput.value = parsed.major;
                    if (parsed.education) educationInput.value = parsed.education;
                    if (parsed.topic) researchTopicInput.value = parsed.topic;

                    // 触发现有更新逻辑
                    updateAllPrompts();

                    // 可视反馈：短暂高亮输入框
                    [majorInput, educationInput, researchTopicInput].forEach(el => {
                        el.classList.add('ring', 'ring-green-300');
                        setTimeout(() => el.classList.remove('ring', 'ring-green-300'), 1200);
                    });
                });
            }

            // 清空批量输入
            if (clearBulkBtn) {
                clearBulkBtn.addEventListener('click', function() {
                    if (bulkInput) bulkInput.value = '';
                });
            }

            const copySectionTitleBtn = document.getElementById('copySectionTitleBtn');
            if (copySectionTitleBtn) {
                copySectionTitleBtn.addEventListener('click', function() {
                    navigator.clipboard.writeText('开题报告').then(() => {
                        // 可选：显示已复制提示
                        copyToast.classList.remove('translate-y-20', 'opacity-0');
                        copyToast.classList.add('translate-y-0', 'opacity-100');
                        setTimeout(() => {
                            copyToast.classList.add('translate-y-20', 'opacity-0');
                            copyToast.classList.remove('translate-y-0', 'opacity-100');
                        }, 1500);
                    });
                });
            }
            const copyMermaidBtn = document.getElementById('copyMermaidBtn');
            if (copyMermaidBtn) {
                copyMermaidBtn.addEventListener('click', function() {
                    navigator.clipboard.writeText('https://app.diagrams.net/?src=about').then(() => {
                        // 可选：显示已复制提示
                        copyToast.classList.remove('translate-y-20', 'opacity-0');
                        copyToast.classList.add('translate-y-0', 'opacity-100');
                        setTimeout(() => {
                            copyToast.classList.add('translate-y-20', 'opacity-0');
                            copyToast.classList.remove('translate-y-0', 'opacity-100');
                        }, 1500);
                    });
                });
            }
            const addCaptionBtn = document.getElementById('addCaptionBtn');
            if (addCaptionBtn) {
                addCaptionBtn.addEventListener('click', function() {
                    navigator.clipboard.writeText('题注').then(() => {
                        // 可选：显示已复制提示
                        copyToast.classList.remove('translate-y-20', 'opacity-0');
                        copyToast.classList.add('translate-y-0', 'opacity-100');
                        setTimeout(() => {
                            copyToast.classList.add('translate-y-20', 'opacity-0');
                            copyToast.classList.remove('translate-y-0', 'opacity-100');
                        }, 1500);
                    });
                });
            }
            const createLabelBtn = document.getElementById('createLabelBtn');
            if (createLabelBtn) {
                createLabelBtn.addEventListener('click', function() {
                    navigator.clipboard.writeText('图1.').then(() => {
                        // 可选：显示已复制提示
                        copyToast.classList.remove('translate-y-20', 'opacity-0');
                        copyToast.classList.add('translate-y-0', 'opacity-100');
                        setTimeout(() => {
                            copyToast.classList.add('translate-y-20', 'opacity-0');
                            copyToast.classList.remove('translate-y-0', 'opacity-100');
                        }, 1500);
                    });
                });
            }
            
            // 存储已选择的提示词
            const activePrompts = {
                framework: [],
                background: [],
                background1: [],
                significance: [],
                objectives: [],
                ResearchContent: [],
                ResearchMethods: [],
                PaperOutline: [],
                ResearchFoundation: [],
                ResearchChallenges: [],
                ResearchExpectations: [],
                ResearchTimeline: [],
                ResearchRoadmap: [],
                ResearchRoadmap1: [],
                ResearchKeywords: []
            };
            
            // 基础提示词模板
            const basePrompts = {
                framework: '我是一名【{major}】专业的【{education}】生，即将毕业，我的研究主题是《{topic}》，现在正在写开题报告部分。\n\n请你扮演我的导师，对于我研究的主题学术造诣非常的深。\n\n这是我的开题大纲，你先阅读并且掌握一下\n【\n 一、问题的提出及背景 （不少于 3000 字，可加页） （一） 研究背景 （二）研究意义 （三）国内外研究现状     1.国内研究现状     2.国外研究现状     3.文献述评     4.参考文献（参考文献尽量不要用硕博论文，尽量用高质量的期刊；特别要注意期刊质量以及文章的新颖性）  二、解决问题的思路及方案 （一）研究目标（研究目标简化，还可以条理化，目标 2～3 个就可以了） （二） 研究内容 （三）论文提纲 （四）研究方法 （五）技术路线图（先语言描述研究思路，大致 500 字，然后才是路线图）  三、前期基础 （一）研究基础 参考模板： 1.完成了大部分的理论课程学习，具有了一定的理论基础。研一完成必修课程学习，均取得优良成绩。  2.大量阅读......相关文献，现已完成......研究的文献综述写作。 3.2024 年 9 月参加学校组织的量化研究方法班，初步学习了 Stata15.0 软件的基本操作，为本论文中需要用到的实证方法打下基础。 （二）研究过程中可能遇到的困难和问题  四、预期结果及目标 （一）预期结果 精简一段话就可以，研究过程结果以及完成一篇优秀的硕士论文 （二）进度计划安排 2024 年 9 月 -10 月：XXXXXX 2024 年 11 月 -12 月：XXXXXX 2025 年 1 月 -3 月：XXXXXX 2025 年 4 月 -5 月：XXXXXX 2025 年 6 月 -10 月：XXXXXX 2025 年 11 月 -2026 年 3 月：XXXXXX 2026 年 4 月 -2026 年 6 月：XXXXXX      \n】',
                background: '帮我搜索一下和我主题相关的政策和事实，【{topic}】；我准备放到研究背景中，作为论证补充；',
                background1: '很好，根据上述搜索的结果，我们来写第一章【问题的提出及背景】的第1节【研究背景】  使用学术语言，用文本段的形式回答我；\n不要使用强逻辑的连接词，比如【首先、其次、最后、综上所述】；  注意上下文逻辑；',
                significance: '很好，根据上述你搜索的结果，我们来写第一章【{chapter}】中的第2节【研究意义】，从两个方面阐述【理论意义】和【实践意义】\n使用学术语言，用文本段的形式回答我；\n不要使用强逻辑的连接词，比如【首先、其次、最后、综上所述】；\n注意上下文逻辑；',
                objectives: '很好，根据上述搜索的结果，我们来写第二章【解决问题的思路及方案 】的第1节【研究目标（研究目标简化，还可以条理化，目标 2～3 个就可以了） 】  使用学术语言，用文本段的形式回答我；\n\n不要使用强逻辑的连接词，比如【首先、其次、最后、综上所述】；  注意上下文逻辑；',
                ResearchContent: '很好，根据上述搜索的结果，我们来写第二章【解决问题的思路及方案 】的第2节【研究内容】\n\n这部分的内容写成如下格式：\n\n第一章绪论，本章...\n\n第二章基础理论及相关概念，本章...写成每一章的内容梗概的形式；',
                ResearchMethods: '很好，根据上述搜索的结果，我们来写第二章【解决问题的思路及方案 】的第3节【研究方法 】  使用学术语言，用文本段的形式回答我； \n\n不要使用强逻辑的连接词，比如【首先、其次、最后、综上所述】；  注意上下文逻辑；',
                PaperOutline: '很好，根据上述搜索的结果，我们来写第二章【解决问题的思路及方案 】的第4节【论文提纲】  ,要有二级标题；',
                ResearchFoundation: '很好，根据上述搜索的结果，我们来写第三章【前期基础 】的第1节【研究基础】\n\n参考模板：\n1.完成了大部分的理论课程学习，具有了一定的理论基础。研一完成必修课程学习，均取得优良成绩。\n2.大量阅读……相关文献，现已完成……研究的文献综述写作。\n3.2024年9月参加学校组织的量化研究方法班，初步学习了Stata15.0软件的基本操作，为本论文中需要用到的实证方法打下基础。\n\n使用学术语言，用文本段的形式回答我；\n\n不要使用强逻辑的连接词，比如【首先、其次、最后、综上所述】；  注意上下文逻辑；',
                ResearchChallenges: '很好，根据上述搜索的结果，我们来写第三章【前期基础 】的第1节【研究过程中可能遇到的困难和问题 】  使用学术语言，用文本段的形式回答我；  \n\n不要使用强逻辑的连接词，比如【首先、其次、最后、综上所述】；  注意上下文逻辑；',
                ResearchExpectations: '很好，根据上述搜索的结果，我们来写第四章【预期结果及目标】的第1节【预期结果】 精简一段话就可以；研究过程结果以及完成一篇优秀的论文   \n\n使用学术语言，用文本段的形式回答我；  \n\n不要使用强逻辑的连接词，比如【首先、其次、最后、综上所述】；  注意上下文逻辑；',
                ResearchTimeline: '很好，根据上述搜索的结果，我们来写第四章【预期结果及目标】的第1节【进度计划安排】  使用学术语言，用文本段的形式回答我；  \n\n不要使用强逻辑的连接词，比如【首先、其次、最后、综上所述】；  注意上下文逻辑；',
                ResearchRoadmap: '你是一个Mermaid结构图构建专家，擅长将论文提纲转化为结构清晰、逻辑流畅的技术路线图。请根据以下论文结构生成 Mermaid 格式的代码，具体要求如下：\n\n【基本结构要求】\n使用 graph TB 设置自上而下布局。\n使用一个名为“技术路线图”的总 subgraph 包裹整张图。\n每个一级模块（如“A ["第1章 绪论 "]”）生成一个子图 subgraph A1，并以模块名称作为子图标题，例如subgraph A1 ["绪论"]；\n一级模块 A，连接至对应的子图 A1；但A\B\C\D等一级模块不用箭头相连\n每个子图内包含若干二级节点及三级节点时，使用方括号[" "]形式表示，并且连接（如A1_1["1.1 研究背景与意义"]--> A1_1_1["1.1.1 研究背景"]）。\n\n【样式与节点要求】\n使用 style 设置颜色块区分章节（颜色代码参考如下）：\nA：#FFD1DC\nB：#ADD8E6\nC：#FFE4B5\nD：#D0F0C0\nE：#E0FFFF\n...\n\n【输出格式要求】\n输出完整的 Mermaid 代码（可直接用于 https://www.min2k.com/tools/mermaid/），不要加解释说明。\n所有节点请使用中文。\n层级结构与逻辑顺序应与原始提纲一致。\n\n以下是我的论文提纲，请开始生成：  \n【  】      ',
                ResearchRoadmap1: '这是我的技术路线图，你使用学术语言，用一段话阐述一下，字数500字；  不要使用强逻辑连接词例如：首先、其次、最后、综上所述等；',
                ResearchKeywords: '我是一名【{major}】专业的【{education}】生，即将毕业，我的研究主题是《{topic}》,现在正在查找文献，请你扮演我的校外指导教授，对于我的研究主题非常的擅长，尤其是对于这类题目关键词的拆分是十分熟悉。请你根据我的题目帮我拆分一下关键词，方便我查找国内外的文献，从而来写文献综述。'
            };
            
            // 更新提示词函数
            function updateAllPrompts() {
                const major = majorInput.value.trim() || '请先输入专业';
                const education = educationInput.value.trim() || '请先输入学历';
                const topic = researchTopicInput.value.trim() || '请先输入研究主题';
                const chapter = chapterTitleInput.value.trim() || '请输入章节题目';
                
                // 更新所有提示词
                Object.keys(basePrompts).forEach(group => {
                    let promptElement = document.getElementById(`${group}Prompt`);
                    if (!promptElement) return;
                    
                    // 替换模板变量
                    let basePrompt = basePrompts[group]
                        .replace('{major}', major)
                        .replace('{education}', education)
                        .replace('{topic}', topic)
                        .replace('{chapter}', chapter);
                    
                    // 组合基础提示词和选中的提示词
                    let fullPrompt = basePrompt;
                    activePrompts[group].forEach(prompt => {
                        fullPrompt += '\n' + prompt + ';';
                    });
                    
                    promptElement.textContent = fullPrompt;
                });
            }
            
            // 监听专业输入变化
            majorInput.addEventListener('input', updateAllPrompts);

            // 监听学历输入变化
            educationInput.addEventListener('input', updateAllPrompts);

            // 监听研究主题输入变化
            researchTopicInput.addEventListener('input', updateAllPrompts);
            
            // 监听章节题目输入变化
            chapterTitleInput.addEventListener('input', updateAllPrompts);
            
            // 提示词按钮点击事件 - 切换状态
            promptButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const promptText = this.getAttribute('data-prompt');
                    const group = this.getAttribute('data-group');
                    
                    // 检查是否已存在该提示词
                    const index = activePrompts[group].indexOf(promptText);
                    
                    if (index === -1) {
                        // 添加提示词
                        activePrompts[group].push(promptText);
                        this.classList.add('active');
                    } else {
                        // 移除提示词
                        activePrompts[group].splice(index, 1);
                        this.classList.remove('active');
                    }
                    
                    // 更新提示词显示
                    updateAllPrompts();
                    
                    // 添加点击效果
                    this.classList.add('scale-90');
                    setTimeout(() => {
                        this.classList.remove('scale-90');
                    }, 200);
                });
            });
            
            // 复制按钮点击事件
            copyButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    const promptText = document.getElementById(targetId).textContent;
                    
                    // 复制到剪贴板
                    navigator.clipboard.writeText(promptText).then(() => {
                        // 显示复制成功提示
                        copyToast.classList.remove('translate-y-20', 'opacity-0');
                        copyToast.classList.add('translate-y-0', 'opacity-100');
                        
                        // 3秒后隐藏提示
                        setTimeout(() => {
                            copyToast.classList.add('translate-y-20', 'opacity-0');
                            copyToast.classList.remove('translate-y-0', 'opacity-100');
                        }, 3000);
                    });
                });
            });

            // 自动为H3标题添加序号的函数
            function autoNumberH3Headings() {
                // 获取所有section中的H3元素
                const sections = document.querySelectorAll('section');
                
                sections.forEach(section => {
                    // 获取当前section下的所有H3元素
                    const h3Headings = section.querySelectorAll('h3');
                    
                    // 为每个H3设置序号
                    h3Headings.forEach((heading, index) => {
                        // 找到序号显示元素（圆形数字标记）
                        const numberElement = heading.querySelector('span[class*="rounded-full"]');
                        if (numberElement) {
                            // 设置序号
                            numberElement.textContent = index + 1;
                        }
                    });
                });
            }
            
            // 初始执行一次
            autoNumberH3Headings();
            
            // 如果未来有动态添加H3的需求，可以再次调用该函数
            // 例如: 在添加新的H3元素后调用 autoNumberH3Headings();
            
            // 导航项点击事件 - 桌面端
            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // 移除所有导航项的活跃状态
                    navItems.forEach(nav => {
                        nav.classList.remove('nav-active');
                        nav.classList.add('text-gray-600', 'hover:bg-gray-100');
                    });
                    
                    // 添加当前导航项的活跃状态
                    this.classList.add('nav-active');
                    this.classList.remove('text-gray-600', 'hover:bg-gray-100');
                    
                    // 滚动到对应部分
                    const targetId = this.getAttribute('href').substring(1);
                    document.getElementById(targetId).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });
            
            // 导航项点击事件 - 移动端
            mobileNavItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // 移除所有导航项的活跃状态
                    mobileNavItems.forEach(nav => {
                        nav.classList.remove('nav-active');
                        nav.classList.add('text-gray-600', 'hover:bg-gray-100');
                    });
                    
                    // 添加当前导航项的活跃状态
                    this.classList.add('nav-active');
                    this.classList.remove('text-gray-600', 'hover:bg-gray-100');
                    
                    // 关闭移动菜单
                    mobileMenuContent.classList.add('-translate-x-full');
                    setTimeout(() => {
                        mobileMenu.classList.add('hidden');
                    }, 300);
                    
                    // 滚动到对应部分
                    const targetId = this.getAttribute('href').substring(1);
                    document.getElementById(targetId).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });
            
            // 移动端菜单切换
            menuToggle.addEventListener('click', function() {
                mobileMenu.classList.remove('hidden');
                setTimeout(() => {
                    mobileMenuContent.classList.remove('-translate-x-full');
                }, 10);
            });
            
            // 关闭移动端菜单
            closeMenu.addEventListener('click', function() {
                mobileMenuContent.classList.add('-translate-x-full');
                setTimeout(() => {
                    mobileMenu.classList.add('hidden');
                }, 300);
            });
            
            // 点击移动端菜单外部关闭菜单
            mobileMenu.addEventListener('click', function(e) {
                if (e.target === this) {
                    mobileMenuContent.classList.add('-translate-x-full');
                    setTimeout(() => {
                        mobileMenu.classList.add('hidden');
                    }, 300);
                }
            });
            
            // 初始化所有提示词
            updateAllPrompts();

            // ---- 修改开始：使用每个主导航项的 .sub-nav-container，通过类 hidden 控制显示/隐藏 ----
            // 注意：不要重复声明 subNavContainer（已移除原来的声明）
            function generateSubNavInto(sectionId, container) {
                if (!container) return;
                container.innerHTML = '';
                const section = document.getElementById(sectionId);
                if (!section) {
                    container.classList.add('hidden');
                    return;
                }
                const h3s = section.querySelectorAll('h3');
                if (h3s.length === 0) {
                    container.classList.add('hidden');
                    return;
                }
                h3s.forEach((h3, idx) => {
                    if (!h3.id) h3.id = `${sectionId}-h3-${idx+1}`;
                    const text = h3.textContent.trim();
                    const li = document.createElement('li');
                    li.innerHTML = `<a href="#${h3.id}" class="sub-nav-item flex items-center px-8 py-2 text-xs text-gray-500 hover:text-primary hover:bg-gray-100 rounded transition-all duration-200">${text}</a>`;
                    container.appendChild(li);
                });
                container.classList.remove('hidden');
            }

            // 给每个主导航项绑定点击，生成对应子导航并实现折叠
            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();

                    // 移除其他导航项的活跃状态
                    navItems.forEach(nav => {
                        nav.classList.remove('nav-active');
                        nav.classList.add('text-gray-600', 'hover:bg-gray-100');
                    });

                    // 添加当前导航项活跃状态
                    this.classList.add('nav-active');
                    this.classList.remove('text-gray-600', 'hover:bg-gray-100');

                    const targetId = this.getAttribute('href').substring(1);

                    // 找到当前主项下的子导航容器
                    const parentLi = this.closest('li');
                    const container = parentLi ? parentLi.querySelector('.sub-nav-container') : null;

                    // 如果容器存在且当前已显示，则折叠；否则隐藏所有容器并为当前生成并显示子导航
                    if (container) {
                        const isShown = !container.classList.contains('hidden') && container.innerHTML.trim() !== '';
                        if (isShown) {
                            container.classList.add('hidden');
                        } else {
                            document.querySelectorAll('.sub-nav-container').forEach(c => c.classList.add('hidden'));
                            generateSubNavInto(targetId, container);
                        }
                    } else {
                        // 没有子导航容器的主项，确保所有子导航收起
                        document.querySelectorAll('.sub-nav-container').forEach(c => c.classList.add('hidden'));
                    }

                    // 滚动到对应部分
                    const targetEl = document.getElementById(targetId);
                    if (targetEl) {
                        targetEl.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });

            // 初始：为第一个（开题报告）生成子导航（若存在）
            const firstNav = document.querySelector('.nav-item[href="#开题报告"]');
            if (firstNav) {
                const parentLi = firstNav.closest('li');
                const container = parentLi ? parentLi.querySelector('.sub-nav-container') : null;
                if (container) {
                    generateSubNavInto('开题报告', container);
                }
            }

            // 子导航点击滚动（事件委托，适用于所有容器）
            document.querySelectorAll('.sub-nav-container').forEach(ul => {
                ul.addEventListener('click', function(e) {
                    if (e.target.classList.contains('sub-nav-item')) {
                        e.preventDefault();
                        const targetId = e.target.getAttribute('href').substring(1);
                        const target = document.getElementById(targetId);
                        if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                });
            });


            // 回到顶部：根据滚动位置显示/隐藏按钮，点击平滑回到顶部
            if (backToTop) {
                const toggleBackToTop = () => {
                    if (window.scrollY > 200) {
                        backToTop.classList.remove('hidden');
                    } else {
                        backToTop.classList.add('hidden');
                    }
                };

                // 页面滚动时控制显示
                window.addEventListener('scroll', toggleBackToTop, { passive: true });
                // 初始判断
                toggleBackToTop();

                // 点击回到顶部
                backToTop.addEventListener('click', () => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            }
            if (backToTop) {
                const mainEl = document.querySelector('main');

                const toggleBackToTop = () => {
                    const scrollPos = mainEl ? mainEl.scrollTop : window.scrollY;
                    if (scrollPos > 200) {
                        backToTop.classList.remove('hidden');
                    } else {
                        backToTop.classList.add('hidden');
                    }
                };

                // 如果 main 存在，监听 main 的滚动；否则回退到 window
                if (mainEl) {
                    mainEl.addEventListener('scroll', toggleBackToTop, { passive: true });
                } else {
                    window.addEventListener('scroll', toggleBackToTop, { passive: true });
                }

                // 初始判断
                toggleBackToTop();

                // 点击回到顶部：优先让 main 滚动到顶部
                backToTop.addEventListener('click', () => {
                    if (mainEl) {
                        mainEl.scrollTo({ top: 0, behavior: 'smooth' });
                    } else {
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                });
            }
        });
    </script>
</body>
</html>